<?phpnamespace Centersis\Zion\Acesso;use Zion\Banco\Conexao;class AcessoSql{    protected $con;    public function __construct()    {        $this->con = Conexao::conectar();    }    /**     * Retorna o objeto QueryBuilder montando o sql para retornar a descrição      * do módulo indicado pelo parametro     * @param string $modulo_nome     * @return \Doctrine\DBAL\Query\QueryBuilder     */    public function dadosModulo($modulo_nome)    {        $qb = $this->con->qb();        $qb->select('*')            ->from('_modulo', '')            ->where($qb->expr()->eq('modulo_cod', ':modulo_nome'))            ->setParameter('modulo_nome', $modulo_nome, \PDO::PARAM_STR);        return $qb;    }    /**     * Retorna o objeto QueryBuilder montando o sql para verificar      * se o usuário tem permissão para acessar o módulo     * @param string $modulo_nome     * @param string $acao_modulo_id_permissao     * @param int $usuario_cod     * @return \Doctrine\DBAL\Query\QueryBuilder     */    public function permissaoAcao($modulo_nome, $acao_modulo_id_permissao, $usuario_cod)    {        $qb = $this->con->qb();        $qb->select('a.usuario_cod')            ->from('_usuario', 'a')            ->innerJoin('a', '_perfil', 'b', 'a.perfil_cod = b.perfil_cod')            ->innerJoin('b', '_permissao', 'c', 'b.perfil_cod = c.perfil_cod')            ->innerJoin('c', '_acao_modulo', 'd', 'c.acao_modulo_cod = d.acao_modulo_cod')            ->innerJoin('d', '_modulo', 'e', 'd.modulo_cod = e.modulo_cod')            ->where($qb->expr()->eq('a.usuario_cod', ':usuario_cod'))            ->andWhere($qb->expr()->eq('d.acao_modulo_id_permissao', ':acao_modulo_id_permissao'))            ->andWhere($qb->expr()->eq('e.modulo_nome', ':modulo_nome'))            ->setParameter('usuario_cod', $usuario_cod, \PDO::PARAM_INT)            ->setParameter('acao_modulo_id_permissao', $acao_modulo_id_permissao, \PDO::PARAM_STR)            ->setParameter('modulo_nome', $modulo_nome, \PDO::PARAM_STR);        return $qb;    }    /**     * Retorna o objeto QueryBuilder montando o sql para retornar      * as opções de módulo que o usuário tem direito     * @param string $modulo_nome     * @param int $usuario_cod     * @return \Doctrine\DBAL\Query\QueryBuilder     */    public function permissoesModulo($modulo_nome, $usuario_cod)    {        $qb = $this->con->qb();        $qb->select('d.*')            ->from('_usuario', 'a')            ->innerJoin('a', '_perfil', 'b', 'a.perfil_cod = b.perfil_cod')            ->innerJoin('b', '_permissao', 'c', 'b.perfil_cod = c.perfil_cod')            ->innerJoin('c', '_acao_modulo', 'd', 'c.acao_modulo_cod = d.acao_modulo_cod')            ->innerJoin('d', '_modulo', 'e', 'd.modulo_cod = e.modulo_cod')            ->where($qb->expr()->eq('a.usuario_cod', ':usuario_cod'))            ->andWhere($qb->expr()->eq('e.modulo_nome', ':modulo_nome'))            ->setParameter('usuario_cod', $usuario_cod, \PDO::PARAM_INT)            ->setParameter('modulo_nome', $modulo_nome, \PDO::PARAM_STR);        return $qb;    }    /**     * Retorna o objeto QueryBuilder montando o sql para retornar      * os dados de uma ação do módulo     * @param string $modulo_nome     * @param string $acao_modulo_id_permissao     * @return \Doctrine\DBAL\Query\QueryBuilder     */    public function dadosAcaoModulo($modulo_nome, $acao_modulo_id_permissao)    {        $qb = $this->con->qb();        $qb->select('a.*')            ->from('_acao_modulo', 'a')            ->innerJoin('a', '_modulo', 'b', 'a.modulo_cod = b.modulo_cod')            ->where($qb->expr()->eq('a.acao_modulo_id_permissao', ':acao_modulo_id_permissao'))            ->andWhere($qb->expr()->eq('b.modulo_nome', ':modulo_nome'))            ->setParameter('acao_modulo_id_permissao', $acao_modulo_id_permissao, \PDO::PARAM_STR)            ->setParameter('modulo_nome', $modulo_nome, \PDO::PARAM_STR);        return $qb;    }    /**     * Retorna o objeto QueryBuilder montando o sql para retornar      * as ações de módulo que o usuário tem direito     * @param string $modulo_nome     * @param int $usuario_cod     * @return \Doctrine\DBAL\Query\QueryBuilder     */    public function acoesModulo($modulo_nome, $usuario_cod, $condicao = '')    {        $qb = $this->con->qb();        $qb->select('d.*')            ->from('_usuario', 'a')            ->innerJoin('a', '_perfil', 'b', 'a.perfil_cod = b.perfil_cod')            ->innerJoin('b', '_permissao', 'c', 'b.perfil_cod = c.perfil_cod')            ->innerJoin('c', '_acao_modulo', 'd', 'c.acao_modulo_cod = d.acao_modulo_cod')            ->innerJoin('d', '_modulo', 'e', 'd.modulo_cod = e.modulo_cod')            ->where($qb->expr()->eq('a.usuario_cod', ':usuario_cod'))            ->andWhere($qb->expr()->eq('e.modulo_nome', ':modulo_nome'))            ->andWhere($condicao)            ->setParameter('usuario_cod', $usuario_cod, \PDO::PARAM_INT)            ->setParameter('modulo_nome', $modulo_nome, \PDO::PARAM_STR)            ->orderBy('d.acao_modulo_posicao');        return $qb;    }    /**     * Retorna o objeto QueryBuilder montando o sql para retornar      * os dados de uma ação do módulo a partir de acao_modulo_cod     * @param string $modulo_nome     * @param string $acao_modulo_cod     * @return \Doctrine\DBAL\Query\QueryBuilder     */    public function dadosAcaoModuloCod($modulo_nome, $acao_modulo_cod)    {        $qb = $this->con->qb();        $qb->select('a.*')            ->from('_acao_modulo', 'a')            ->innerJoin('a', '_modulo', 'b', 'a.modulo_cod = b.modulo_cod')            ->where($qb->expr()->eq('a.acao_modulo_cod', ':acao_modulo_cod'))            ->andWhere($qb->expr()->eq('b.modulo_nome', ':modulo_nome'))            ->setParameter('acao_modulo_cod', $acao_modulo_cod, \PDO::PARAM_INT)            ->setParameter('modulo_nome', $modulo_nome, \PDO::PARAM_STR);        return $qb;    }}