<?php/****    Sappiens Framework*    Copyright (C) 2014, BRA Consultoria**    Website do autor: www.braconsultoria.com.br/sappiens*    Email do autor: sappiens@braconsultoria.com.br**    Website do projeto, equipe e documentação: www.sappiens.com.br*   *    Este programa é software livre; você pode redistribuí-lo e/ou*    modificá-lo sob os termos da Licença Pública Geral GNU, conforme*    publicada pela Free Software Foundation, versão 2.**    Este programa é distribuído na expectativa de ser útil, mas SEM*    QUALQUER GARANTIA; sem mesmo a garantia implícita de*    COMERCIALIZAÇÃO ou de ADEQUAÇÃO A QUALQUER PROPÓSITO EM*    PARTICULAR. Consulte a Licença Pública Geral GNU para obter mais*    detalhes.* *    Você deve ter recebido uma cópia da Licença Pública Geral GNU*    junto com este programa; se não, escreva para a Free Software*    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA*    02111-1307, USA.**    Cópias da licença disponíveis em /Sappiens/_doc/licenca**//** * @author Pablo Vanni - pablovanni@gmail.com * @since 23/02/2005 * Última Atualização: 14/10/2014 * Atualizada Por: Pablo Vanni - pablovanni@gmail.com * @name Verifica permissões e fornece informações de acesso sobre modulos */namespace Zion\Acesso;class Acesso extends AcessoVO{    private $acessoSql;    private $con;   /**    * Ao iniciar a intancia com o parametro de ação, será verificado    * automaticamente se existe permissão para a ação.    * Este método tambem seta o nome do módulo que previamente deveria existir    * como constante e tambem o código do usuário ativo que previamente    * deveria existir na sessão ativa.    * @param string $acaoModuloIdPermissao    * @throws \Exception    */    public function __construct($acaoModuloIdPermissao = '')    {        $this->con = \Zion\Banco\Conexao::conectar();        $this->acessoSql = new AcessoSql();        if(\defined('MODULO')) {                    parent::setModuloNome(\constant('MODULO'));                    }                if(isset($_SESSION['usuarioCod'])) {                    parent::setUsuarioCod($_SESSION['usuarioCod']);                    }                if(!empty($acaoModuloIdPermissao)){            if(!$this->permissaoAcao($acaoModuloIdPermissao)){                throw new \Exception('Sem permissão');            }        }    }    /**     * Ao informar a acão, o metodo verifica se o usuário tem acesso a ela (ação),     * este método captura automaticamente o usuarioCod da sessão e nome do      * módulo que deve ser definido como variavel constante     * @param string $acaoModuloIdPermissao     * @return bool     */    public function permissaoAcao($acaoModuloIdPermissao)    {        return (bool) $this->con->execNLinhas($this->acessoSql->permissaoAcao(parent::getModuloNome(), $acaoModuloIdPermissao, parent::getUsuarioCod()));    }    /**     * Retorna os dados de um módulo, o módulo em questão estaria definido previamente     * como uma constante     * @return array     */    public function dadosModulo()    {        return $this->con->execLinha($this->acessoSql->dadosModulo(parent::getModuloNome()));    }    /**     * Retorna os dados de uma ação de um módulo,     * este método captura automaticamente o usuarioCod da sessão e nome do      * módulo que deve ser definido como variavel constante     * @param string $acaoModuloIdPermissao     * @return array     */    public function dadosAcaoModulo($acaoModuloIdPermissao)    {        return $this->con->execLinha($this->acessoSql->dadosAcaoModulo(parent::getModuloNome, $acaoModuloIdPermissao));    }    /**     * Retorna as opções de módulo que o usuário tem direito     * @return array     */    public function permissoesModulo()    {        return $this->con->paraArray($this->acessoSql->permissoesModulo(parent::getModuloNome(), parent::getUsuarioCod()),null, 'acaomoduloidpermissao');    }}